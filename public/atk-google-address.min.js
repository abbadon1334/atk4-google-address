!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("atk"),require("jQuery")):"function"==typeof define&&define.amd?define("atk-google-address",["atk","jQuery"],t):"object"==typeof exports?exports["atk-google-address"]=t(require("atk"),require("jQuery")):e["atk-google-address"]=t(e.atk,e.jQuery)}(this,function(e,t){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){return i(this,e),this.instance||(this.instance=this,this.map={}),this.instance}return o(e,null,[{key:"getInstance",value:function(){return this.instance}}]),o(e,[{key:"initGoogleApi",value:function(){this.map.apiLoaded=Promise.resolve(!0)}},{key:"getAutocomplete",value:function(e){return new google.maps.places.Autocomplete(e)}}]),e}(),u=new r;Object.freeze(u),t.default=u,e.exports=t.default},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=n(3),s=i(u),a=n(0),l=i(a),c=function(){function e(t,n){o(this,e),this.$el=(0,s.default)(t),this.$input=this.$el.find("input"),this.settings=n,this.autocomplete=null,this.fields=[],this.main()}return r(e,[{key:"main",value:function(){var e=this;l.default.map.apiLoaded.then(function(t){e.initMap(),e.settings.useBrowserLocation&&e.$input.on("focus",e,e.geolocate),e.$input.on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation())})}),this.initField()}},{key:"initMap",value:function(){var e=this;this.autocomplete=l.default.getAutocomplete(this.$input[0]),this.settings.options&&this.autocomplete.setOptions(this.settings.options),this.settings.countryLimit&&this.autocomplete.setComponentRestrictions({country:this.settings.countryLimit}),this.autocomplete.setTypes(this.settings.types),this.autocomplete.addListener("place_changed",function(){e.fillAddress(e.autocomplete.getPlace())})}},{key:"initField",value:function(){var e=this;if(0===this.settings.fieldMap.length?this.fields=this.getInputsField():this.fields=this.getMappedFields(this.settings.fieldMap),this.fields.length>0){var t=this.fields.findIndex(function(t){if(t.input.attr("name")===e.$input.attr("name"))return t});t>=0&&this.fields.splice(t,1)}}},{key:"geolocate",value:function(e){var t=e.data;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){var n={lat:e.coords.latitude,lng:e.coords.longitude},i=new google.maps.Circle({center:n,radius:e.coords.accuracy});t.autocomplete.setBounds(i.getBounds())})}},{key:"fillAddress",value:function(e){if(e.hasOwnProperty("address_components")){this.fields.forEach(function(e){e.input.val("")}),this.fields.forEach(function(t){var n=t.concat.reduce(function(n,i,o){var r="";if("lat"===i.type||"lng"===i.type)r=e.geometry.location[i.type]();else for(var u=0;u<e.address_components.length;u++){var s=e.address_components[u].types[0];i.type===s&&(r=e.address_components[u][i.property])}return 0===o?r:n+t.glue+r},"");t.input.val(n)})}}},{key:"getMappedFields",value:function(e){var t=this;return e.map(function(e){var n=Object.keys(e)[0],i=e[n].hasOwnProperty("glue")?e[n].glue:t.settings.glue;return{name:n,input:t.$el.parents("form").find('input[name="'+n+'"]'),concat:e[n].concat,glue:i}})}},{key:"getInputsField",value:function(){var e=this;return Array.from(this.$el.parents("form").find("input"),function(t){var n=(0,s.default)(t),i=n.attr("name"),o={name:i,input:n,glue:""},r=[];return r.push({type:i,property:e.settings.useLongName?"long_name":"short_name"}),o.concat=r,o})}}]),e}();t.default=c,c.DEFAULTS={options:null,types:["geocode"],useBrowserLocation:!1,countryLimit:null,useLongName:!0,fieldMap:[],glue:" "},e.exports=t.default},function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var o=n(2),r=i(o),u=n(0),s=i(u),a=n(1),l=i(a);r.default.registerPlugin("AddressLookup",l.default),r.default.mapService=s.default}])});